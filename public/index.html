<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TalkHint - Phone Call Transcription</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            grid-column: 1 / -1;
        }
        
        .dialog-column {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .transcription-column {
            grid-column: 1 / -1;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .message {
            margin-bottom: 20px;
            padding: 10px;
            border-radius: 4px;
        }
        
        .message.owner {
            background-color: #e3f2fd;
            margin-right: 20%;
        }
        
        .message.guest {
            background-color: #f5f5f5;
            margin-left: 20%;
        }
        
        .message .original {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .message .translation {
            color: #666;
            font-style: italic;
        }
        
        .transcription {
            font-family: monospace;
            white-space: pre-wrap;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        .transcription .interim {
            color: #666;
        }
        
        .transcription .final {
            color: #000;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>TalkHint - Phone Call Transcription</h1>
        </div>
        
        <div class="dialog-column" id="owner-column">
            <h2>Owner Messages</h2>
            <div id="owner-messages"></div>
        </div>
        
        <div class="dialog-column" id="guest-column">
            <h2>Guest Messages</h2>
            <div id="guest-messages"></div>
        </div>
        
        <div class="transcription-column">
            <h2>Live Transcription</h2>
            <div id="transcription" class="transcription"></div>
        </div>
    </div>
    
    <script>
        // WebSocket connection
        const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const wsUrl = `${wsProtocol}//${window.location.host}`;
        const ws = new WebSocket(wsUrl);
        
        // DOM elements
        const ownerMessages = document.getElementById('owner-messages');
        const guestMessages = document.getElementById('guest-messages');
        const transcription = document.getElementById('transcription');
        
        // Handle WebSocket messages
        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            
            switch (data.type) {
                case 'init':
                    // Initialize with existing dialogs
                    data.data.forEach(dialog => {
                        dialog.messages.forEach(addMessage);
                        dialog.transcription.forEach(addTranscription);
                    });
                    break;
                    
                case 'message':
                    addMessage(data.data);
                    break;
                    
                case 'transcription':
                    addTranscription(data.data);
                    break;
            }
        };
        
        // Add a message to the dialog
        function addMessage(message) {
            const container = document.createElement('div');
            container.className = `message ${message.source}`;
            
            const original = document.createElement('div');
            original.className = 'original';
            original.textContent = message.originalText;
            
            const translation = document.createElement('div');
            translation.className = 'translation';
            translation.textContent = message.translatedText;
            
            container.appendChild(original);
            container.appendChild(translation);
            
            if (message.source === 'owner') {
                ownerMessages.appendChild(container);
            } else {
                guestMessages.appendChild(container);
            }
        }
        
        // Add a transcription segment
        function addTranscription(segment) {
            const span = document.createElement('span');
            span.className = segment.isFinal ? 'final' : 'interim';
            span.textContent = segment.text + ' ';
            
            transcription.appendChild(span);
            
            if (segment.isFinal) {
                transcription.appendChild(document.createElement('br'));
            }
        }
    </script>
</body>
</html> 